<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nobita Feedback App</title>
  <style>
    /* Reset & base */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7fc; color: #333; }
    a { text-decoration: none; color: inherit; }
    /* Container */
    .container { max-width: 900px; margin: 40px auto; padding: 0 20px; }
    header { text-align: center; margin-bottom: 30px; }
    h1 { font-size: 2.5rem; color: #1e212d; margin-bottom: 10px; }
    /* Forms */
    .form-card { background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 30px; transition: transform .3s; }
    .form-card:hover { transform: translateY(-5px); }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
    .form-group input, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
    .star-rating { display: flex; gap: 5px; margin-top: 5px; }
    .star-rating span { font-size: 1.5rem; cursor: pointer; transition: transform .2s; }
    .star-rating span:hover { transform: scale(1.2); }
    button { padding: 10px 20px; border: none; border-radius: 4px; background: #6a0dad; color: #fff; font-weight: bold; cursor: pointer; transition: background .3s; }
    button:hover { background: #5809a1; }
    /* Feedback List */
    .feedback-list { display: grid; grid-template-columns: 1fr; gap: 20px; }
    .feedback-card { background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; transition: transform .3s; }
    .feedback-card:hover { transform: translateY(-5px); }
    .avatar { flex-shrink: 0; width: 80px; height: 80px; border-radius: 50%; margin: 15px; border: 2px solid #6a0dad; overflow: hidden; }
    .avatar img { width: 100%; height: 100%; object-fit: cover; }
    .feedback-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; }
    .feedback-header { display: flex; justify-content: space-between; align-items: center; }
    .feedback-name { font-weight: 700; font-size: 1.1rem; color: #1e212d; }
    .feedback-stars { color: #f1c40f; }
    .feedback-body { margin-top: 10px; flex-grow: 1; line-height: 1.4; }
    .feedback-time { font-size: 0.85rem; color: #777; margin-top: 10px; text-align: right; }
    /* Hidden sections */
    #feedback-section, #logout-btn { display: none; }
    /* Animations */
    .fade-in { animation: fadeIn 0.6s ease-out; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Nobita Feedback App</h1>
      <nav>
        <button id="show-login">Login</button>
        <button id="show-signup">Sign Up</button>
        <button id="logout-btn">Logout</button>
      </nav>
    </header><!-- Login Form -->
<div id="login-card" class="form-card fade-in">
  <h2>Login</h2>
  <div class="form-group"><label>Email</label><input type="email" id="login-email" /></div>
  <div class="form-group"><label>Password</label><input type="password" id="login-password" /></div>
  <button id="login-btn">Login</button>
</div>

<!-- Signup Form -->
<div id="signup-card" class="form-card fade-in" style="display:none;">
  <h2>Sign Up</h2>
  <div class="form-group"><label>Name</label><input type="text" id="signup-name" /></div>
  <div class="form-group"><label>Email</label><input type="email" id="signup-email" /></div>
  <div class="form-group"><label>Password</label><input type="password" id="signup-password" /></div>
  <button id="signup-btn">Sign Up</button>
</div>

<!-- Feedback Submission -->
<div id="feedback-section" class="form-card fade-in">
  <h2>Submit Feedback</h2>
  <div class="form-group"><label>Your Feedback</label><textarea id="feedback-text" rows="3"></textarea></div>
  <div class="form-group"><label>Rating</label><div id="star-widget" class="star-rating"></div></div>
  <button id="submit-feedback">Submit</button>
</div>

<!-- Feedback List -->
<div id="feedback-list" class="feedback-list fade-in"></div>

  </div>  <script>
    const apiBase = 'https://nobita-feedback-app-online.onrender.com';
    let token = localStorage.getItem('token') || '';
    let selectedRating = 0;

    // Elements
    const loginCard = document.getElementById('login-card');
    const signupCard = document.getElementById('signup-card');
    const feedbackSection = document.getElementById('feedback-section');
    const feedbackList = document.getElementById('feedback-list');
    const logoutBtn = document.getElementById('logout-btn');

    // Navigation
    document.getElementById('show-login').onclick = () => { loginCard.style.display = 'block'; signupCard.style.display = 'none'; };
    document.getElementById('show-signup').onclick = () => { signupCard.style.display = 'block'; loginCard.style.display = 'none'; };
    logoutBtn.onclick = () => { token=''; localStorage.removeItem('token'); window.location.reload(); };

    // Initialize star rating widget
    const starWidget = document.getElementById('star-widget');
    for (let i = 1; i <= 5; i++) {
      const star = document.createElement('span');
      star.innerHTML = '★';
      star.onclick = () => { setRating(i); };
      starWidget.appendChild(star);
    }
    function setRating(r) {
      selectedRating = r;
      Array.from(starWidget.children).forEach((s, idx) => s.style.color = idx < r ? '#f1c40f' : '#ccc');
    }

    // Auth & UI toggle
    if (token) showApp(); else showLogin();

    // Functions
    async function login() {
      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;
      const res = await fetch(`${apiBase}/api/auth/login`, { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ email, password }) });
      const data = await res.json(); if (res.ok) { token = data.token; localStorage.setItem('token', token); showApp(); } else alert(data.message);
    }
    async function signup() {
      const name = document.getElementById('signup-name').value;
      const email = document.getElementById('signup-email').value;
      const password = document.getElementById('signup-password').value;
      const res = await fetch(`${apiBase}/api/auth/signup`, { method: 'POST', headers: { 'Content-Type':'application/json' }, body: JSON.stringify({ name, email, password }) });
      const data = await res.json(); if (res.ok) { token = data.token; localStorage.setItem('token', token); showApp(); } else alert(data.message);
    }
    async function submitFeedback() {
      const feedback = document.getElementById('feedback-text').value;
      if (!feedback || selectedRating < 1) return alert('Feedback aur rating zaroori hai');
      const res = await fetch(`${apiBase}/api/feedback`, { method: 'POST', headers: {
        'Content-Type':'application/json', 'Authorization': 'Bearer ' + token
      }, body: JSON.stringify({ feedback, rating: selectedRating }) });
      const data = await res.json();
      if (res.ok) { renderFeedbacks(); document.getElementById('feedback-text').value=''; setRating(0); } else alert(data.message);
    }
    async function renderFeedbacks() {
      feedbackList.innerHTML = '';
      const res = await fetch(`${apiBase}/api/feedbacks`);
      const all = await res.json();
      all.forEach(fb => {
        const card = document.createElement('div'); card.className='feedback-card fade-in';
        const avatarDiv = document.createElement('div'); avatarDiv.className='avatar';
        const img = document.createElement('img');
        // DiceBear avatar
        img.src = `https://api.dicebear.com/8.x/adventurer/svg?seed=${encodeURIComponent(fb.name)}&flip=true&radius=50&scale=90`;
        avatarDiv.appendChild(img);
        const content = document.createElement('div'); content.className='feedback-content';
        content.innerHTML = `
          <div class='feedback-header'>
            <div class='feedback-name'>${fb.name}</div>
            <div class='feedback-stars'>${'★'.repeat(fb.rating)}${'☆'.repeat(5-fb.rating)}</div>
          </div>
          <div class='feedback-body'>${fb.feedback}</div>
          <div class='feedback-time'>${new Date(fb.timestamp).toLocaleString()}</div>
        `;
        card.appendChild(avatarDiv); card.appendChild(content);
        feedbackList.appendChild(card);
      });
    }

    function showLogin() { loginCard.style.display='block'; signupCard.style.display='none'; feedbackSection.style.display='none'; logoutBtn.style.display='none'; }
    function showApp() { loginCard.style.display='none'; signupCard.style.display='none'; feedbackSection.style.display='block'; logoutBtn.style.display='inline-block'; renderFeedbacks(); }

    // Event Listeners
    document.getElementById('login-btn').onclick = login;
    document.getElementById('signup-btn').onclick = signup;
    document.getElementById('submit-feedback').onclick = submitFeedback;
  </script></body>
</html>